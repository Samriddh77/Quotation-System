<!DOCTYPE html>
<html>
<head>
    <title>Quotation Generator</title>
    <style>
        body { font-family: sans-serif; max-width: 800px; margin: 20px auto; }
        .input-group { margin-bottom: 10px; padding: 10px; border: 1px solid #ddd; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { border: 1px solid #333; padding: 8px; text-align: left; }
        @media print { .no-print { display: none; } }
    </style>
</head>
<body>
    <div class="no-print">
        <h1>Generate Quotation</h1>
        
        <h3>Global Discount Override (%)</h3>
        <input type="number" id="discount" placeholder="Leave empty for Standard">
        
        <h3>Items</h3>
        <div id="items">
            <div class="input-group">
                <input type="text" placeholder="Item Name (e.g. 95 X 3)" class="i-name">
                <input type="number" placeholder="Qty" class="i-qty">
            </div>
        </div>
        <button onclick="addItem()">+ Add Another Item</button>
        <br><br>
        <button onclick="generate()" style="font-size: 1.2em; padding: 10px;">GET QUOTATION</button>
        <hr>
    </div>

    <div id="result-area" style="display:none;">
        <h2>Quotation</h2>
        <table id="q-table">
            <thead>
                <tr><th>Description</th><th>Qty</th><th>List Price</th><th>Disc %</th><th>Net Rate</th><th>Total (Incl GST)</th></tr>
            </thead>
            <tbody></tbody>
        </table>
        <h3 style="text-align: right;">Grand Total: <span id="g-total">0</span></h3>
        <button class="no-print" onclick="window.print()">Print / Save as PDF</button>
        <button class="no-print" onclick="location.reload()">New Quote</button>
    </div>

    <script>
        function addItem() {
            const div = document.createElement('div');
            div.className = 'input-group';
            div.innerHTML = '<input type="text" placeholder="Item Name" class="i-name"> <input type="number" placeholder="Qty" class="i-qty">';
            document.getElementById('items').appendChild(div);
        }

        async function generate() {
            const names = document.querySelectorAll('.i-name');
            const qtys = document.querySelectorAll('.i-qty');
            const items = [];
            
            names.forEach((n, i) => {
                if(n.value) items.push({name: n.value, qty: qtys[i].value});
            });

            const discount = document.getElementById('discount').value;

            const res = await fetch('/api/generate', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ items, discount })
            });
            
            const data = await res.json();
            const tbody = document.querySelector('#q-table tbody');
            tbody.innerHTML = '';
            let grand = 0;

            data.forEach(row => {
                if(row.Total) grand += row.Total;
                const tr = `<tr>
                    <td>${row.Description}</td>
                    <td>${row.Qty || ''}</td>
                    <td>${row.ListPrice || ''}</td>
                    <td>${row.Discount || ''}</td>
                    <td>${row.NetRate || ''}</td>
                    <td>${row.Total || 0}</td>
                </tr>`;
                tbody.innerHTML += tr;
            });

            document.getElementById('g-total').innerText = grand.toFixed(2);
            document.getElementById('result-area').style.display = 'block';
        }
    </script>
</body>
</html>